<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Match-Three Game</title>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="canvas">
        <sq class="col2"></sq>

    </div>

    <script>

$(function() {


function numberOfWins() {
    var winsCount=0;
    for(var i=0; i<winsLength; i++) {
        for (var j=wins[i][2]; j<wins[i][3] ; j++) { //row
            for (var k=wins[i][0]; k<wins[i][1]; k++) { //column
                l=j+k*8;
                if(grid[l] === grid[l+wins[i][0]]
                    && grid[l] === grid[l+wins[i][1]]) {
                    winsCount++;
                }
            }
        }
    }
    return winsCount;
}

}

function makeGridNoWins() {
    



}


function initGrid() {
    //fill grid with random squares.
    //content is a colour code. '0' is white. 1-6 are as per css.
    //for(var i=0; i<gridLength; i++) {
    //  var col=Math.floor(Math.random()*7)+1;
    //   grid[i]=(col);
    //  }

    makeGridNowins();

    //start with viable starting grid.
    grid=[1,1,7,6,3,5,7,3,4,3,4,3,6,6,2,3,2,7,2,4,4,1,4,6,2,4,4,6,3,1,5,3,4,7,3,6,5,6,3,7,7,5,7,4,1,3,1,5,4,6,5,2,1,6,2,1,4,5,5,4,4,3,3,2];
    console.log("Number of moves: " + numberOfMoves());
}

function updateDisplay() {
    //display grid - first square is bottom left
    var str=new Array();
    for (var i=gridSideLength-1; i>=0; i--) {
         for(var j=0; j<gridSideLength; j++) {
             str.push("<sq class='col" + grid[i*8+j] + "'></sq>");
         }
     }
    $('#canvas').html("");
    $('#canvas').html(str.join(""));
}

function numberOfMoves() {
    var moveCount=0;
    for(var i=0; i<movesLength; i++) {
        for (var j=0; j<moves[i][4] ; j++) { //row
            for (var k=moves[i][2]; k<moves[i][3]; k++) { //column
                l=j+k*8;
                if(grid[l] === grid[l+moves[i][0]]
                        && grid[l] === grid[l+moves[i][1]]) {
                    moveCount++;
                }
            }
        }
    }
    return moveCount;
}

function selectSquare() {
    //console.log("click!");
    //console.log($(this).index());

    selected.push($(this).index());

    //return from function to await second selected square
    if(selected.length===1) return;

    //if selected has two elements, swap locations (try order in flexbox)


    //test if swap adjacent. If not unswap. selected=[].

    //if adjacent, test number of wins. if none, unswap. selected=[].

    //If there are wins, remove wins, updateDisplay, sleep

    //Move squares

    //Check number of wins. loop till no wins.

    //check number of moves. if none, game over and show 'empty' grid.
    if(numberOfMoves()===0) {
        console.log("Game Over");
        //create grid with all 0.
        for(var i=0; i<gridLength; i++) {
            grid[i]=0;
        }
        //show all squares of the same colour. Refer to CSS for colour used.
        updateDisplay();
        //no event handler after display. Game over.
    } else {
    //if number of moves not none, reset selected to allow for new swaps
        console.log("Selected two new squares");
        selected=[];
    }

}

//create grid, colours
var grid=new Array(64);
var gridLength=grid.length;
var gridSideLength=8;
var selected=[null,null];
var moves = [
    //horizontal moves
    [9,10,0,5,6],
    [1,7,1,6,6],
    [1,10,0,5,6],
    [6,7,2,7,6],
    [2,3,0,4,7],
    [1,3,0,4,7],
    [7,9,1,6,6],
    [9,2,0,5,6],
    //vertical moves
    [9,17,0,6,5],
    [7,15,1,7,5],
    [8,15,1,7,5],
    [8,17,0,6,5],
    [8,24,0,7,4],
    [16,24,0,7,4],
    [7,16,1,7,5],
    [9,16,0,6,5]
];
var movesLength=moves.length;

var wins = [[1,2,0,5,0,7],[8,16,0,7,0,5]];
var winsLength=wins.length;

//initialise grid
initGrid();

//Update display
updateDisplay();

//handle click on squares. Must occur after updateDisplay
$('sq').click(selectSquare);

});
    </script>
</body>
</html>
